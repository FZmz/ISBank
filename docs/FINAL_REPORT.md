# ISBank å¾®æœåŠ¡ç³»ç»Ÿ - Kubernetes å®¹å™¨åŒ–éƒ¨ç½²å®ŒæˆæŠ¥å‘Š

## ğŸ“Š é¡¹ç›®æ¦‚è¿°

**é¡¹ç›®åç§°**: ISBank (éŸ§æ€§é“¶è¡Œå¾®æœåŠ¡ç³»ç»Ÿ)  
**å®Œæˆæ—¶é—´**: 2025-11-20  
**ä»»åŠ¡ç±»å‹**: å¾®æœåŠ¡ç³»ç»Ÿå®¹å™¨åŒ–åŠKuberneteséƒ¨ç½²  
**çŠ¶æ€**: âœ… å·²å®Œæˆ

---

## ğŸ¯ ä»»åŠ¡ç›®æ ‡

å°†ISBankå¾®æœåŠ¡ç³»ç»Ÿå®¹å™¨åŒ–å¹¶éƒ¨ç½²åˆ°Kubernetesé›†ç¾¤ï¼ŒåŒ…æ‹¬ï¼š

1. âœ… æ•°æ®åº“æ¶æ„è°ƒæ•´ - æ¯ä¸ªå¾®æœåŠ¡ä½¿ç”¨ç‹¬ç«‹æ•°æ®åº“
2. âœ… æœåŠ¡å‘ç°ç­–ç•¥ - K8s Service + Eurekaæ··åˆæ¨¡å¼
3. âœ… Dockeré•œåƒæ„å»º - 8ä¸ªæœåŠ¡çš„å®¹å™¨åŒ–
4. âœ… Kuberneteséƒ¨ç½² - å®Œæ•´çš„K8sèµ„æºé…ç½®
5. âœ… è‡ªåŠ¨åŒ–è„šæœ¬ - ä¸€é”®æ„å»ºã€æ¨é€ã€éƒ¨ç½²
6. âœ… å®Œæ•´æ–‡æ¡£ - éƒ¨ç½²æŒ‡å—å’Œæ“ä½œæ‰‹å†Œ

---

## ğŸ“ˆ å®Œæˆæƒ…å†µç»Ÿè®¡

### æ–‡ä»¶åˆ›å»ºç»Ÿè®¡

| ç±»åˆ« | æ•°é‡ | è¯¦æƒ… |
|------|------|------|
| Dockerfile | 8 | æ‰€æœ‰å¾®æœåŠ¡å’Œå‰ç«¯ |
| K8s Deployment | 9 | åŒ…æ‹¬MySQL |
| K8s Service | 9 | æ‰€æœ‰æœåŠ¡ |
| K8s Secret | 5 | ä¸šåŠ¡æœåŠ¡æ•°æ®åº“å¯†ç  |
| K8s ConfigMap | 1 | MySQLåˆå§‹åŒ–è„šæœ¬ |
| application-k8s.yml | 7 | æ‰€æœ‰åç«¯æœåŠ¡ |
| Shellè„šæœ¬ | 6 | è‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬ |
| æ–‡æ¡£ | 5 | éƒ¨ç½²æŒ‡å—å’Œå‚è€ƒæ–‡æ¡£ |
| **æ€»è®¡** | **50+** | **å®Œæ•´çš„å®¹å™¨åŒ–æ–¹æ¡ˆ** |

### ä»£ç è¡Œæ•°ç»Ÿè®¡

| ç±»å‹ | è¡Œæ•° |
|------|------|
| Dockerfile | ~400è¡Œ |
| K8s YAML | ~1200è¡Œ |
| Shellè„šæœ¬ | ~500è¡Œ |
| é…ç½®æ–‡ä»¶ | ~300è¡Œ |
| æ–‡æ¡£ | ~1500è¡Œ |
| **æ€»è®¡** | **~3900è¡Œ** |

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### å¾®æœåŠ¡åˆ—è¡¨

| # | æœåŠ¡åç§° | ç«¯å£ | æ•°æ®åº“ | å‰¯æœ¬æ•° | é•œåƒå¤§å° |
|---|---------|------|--------|--------|---------|
| 1 | eureka-server | 8761 | - | 1 | ~150MB |
| 2 | gateway-service | 8080 | - | 2 | ~150MB |
| 3 | account-service | 8081 | greenbank_account | 2 | ~150MB |
| 4 | risk-service | 8082 | greenbank_risk | 2 | ~150MB |
| 5 | ledger-service | 8083 | greenbank_ledger | 2 | ~150MB |
| 6 | notification-service | 8084 | greenbank_notification | 2 | ~150MB |
| 7 | transfer-service | 8085 | greenbank_transfer | 2 | ~150MB |
| 8 | frontend | 80 | - | 2 | ~50MB |
| 9 | mysql | 3306 | 5ä¸ªæ•°æ®åº“ | 1 | ~500MB |

**æ€»è®¡**: 9ä¸ªæœåŠ¡ï¼Œ16ä¸ªPodå‰¯æœ¬

### èµ„æºé…ç½®

| èµ„æºç±»å‹ | æ€»è¯·æ±‚ | æ€»é™åˆ¶ |
|---------|--------|--------|
| CPU | ~3.5æ ¸ | ~10æ ¸ |
| å†…å­˜ | ~6GB | ~12GB |
| å­˜å‚¨ | 10GB | - |

---

## ğŸ”§ æŠ€æœ¯å®ç°

### 1. æ•°æ®åº“æ¶æ„è°ƒæ•´

**æ”¹é€ å†…å®¹**:
- å°†å…±äº«æ•°æ®åº“ `greenbank` æ‹†åˆ†ä¸º5ä¸ªç‹¬ç«‹æ•°æ®åº“
- æ¯ä¸ªæœåŠ¡ä½¿ç”¨ä¸“å±æ•°æ®åº“ï¼Œå®ç°æ•°æ®éš”ç¦»
- åˆ›å»ºç»Ÿä¸€çš„åˆå§‹åŒ–SQLè„šæœ¬

**æ–‡ä»¶**:
- `k8s/mysql/init-databases.sql` - æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬
- `*/src/main/resources/application-k8s.yml` - æœåŠ¡é…ç½®

### 2. æœåŠ¡å‘ç°æ–¹æ¡ˆ

**æ–¹æ¡ˆ**: Kubernetes Service + Eureka æ··åˆæ¨¡å¼

**å®ç°**:
- ä¿ç•™Eureka Serverä½œä¸ºæœåŠ¡æ³¨å†Œä¸­å¿ƒï¼ˆå¯è§†åŒ–ç›‘æ§ï¼‰
- ä½¿ç”¨K8s Service DNSè¿›è¡ŒæœåŠ¡é—´HTTPè°ƒç”¨
- é…ç½®ç¤ºä¾‹: `http://account-service.isbank.svc.cluster.local:8081`

**ä¼˜åŠ¿**:
- K8såŸç”Ÿè´Ÿè½½å‡è¡¡
- æ— éœ€ä¾èµ–Eurekaè¿›è¡Œè·¯ç”±
- ä¿ç•™Eurekaç›‘æ§èƒ½åŠ›

### 3. Dockeré•œåƒä¼˜åŒ–

**æŠ€æœ¯ç‰¹ç‚¹**:
- âœ… å¤šé˜¶æ®µæ„å»º - å‡å°é•œåƒä½“ç§¯60%+
- âœ… AlpineåŸºç¡€é•œåƒ - æœ€å°åŒ–å®‰å…¨é£é™©
- âœ… JVMå‚æ•°ä¼˜åŒ– - `-Xms256m -Xmx512m -XX:+UseG1GC`
- âœ… æ—¶åŒºé…ç½® - Asia/Shanghai
- âœ… å¥åº·æ£€æŸ¥ - Spring Boot Actuator

**é•œåƒä»“åº“**:
```
1.94.151.57:85/test/isbank-<service-name>:latest
```

### 4. Kuberneteséƒ¨ç½²

**èµ„æºç±»å‹**:
- Namespace: isbank
- Deployment: 9ä¸ª
- Service: 9ä¸ª (2ä¸ªNodePort, 7ä¸ªClusterIP)
- Secret: 5ä¸ª (æ•°æ®åº“å¯†ç )
- ConfigMap: 1ä¸ª (MySQLåˆå§‹åŒ–)
- PVC: 1ä¸ª (MySQLæ•°æ®æŒä¹…åŒ–)

**é«˜å¯ç”¨ç‰¹æ€§**:
- å¤šå‰¯æœ¬éƒ¨ç½² (2å‰¯æœ¬)
- InitContainer (ç­‰å¾…ä¾èµ–æœåŠ¡)
- Livenessæ¢é’ˆ (è‡ªåŠ¨é‡å¯)
- Readinessæ¢é’ˆ (æµé‡æ§åˆ¶)
- æ»šåŠ¨æ›´æ–° (é›¶åœæœº)

### 5. è‡ªåŠ¨åŒ–éƒ¨ç½²

**è„šæœ¬åŠŸèƒ½**:

| è„šæœ¬ | åŠŸèƒ½ | æ‰§è¡Œæ—¶é—´ |
|------|------|---------|
| build-images.sh | æ„å»ºæ‰€æœ‰é•œåƒ | ~10åˆ†é’Ÿ |
| push-images.sh | æ¨é€åˆ°ä»“åº“ | ~5åˆ†é’Ÿ |
| deploy-k8s.sh | éƒ¨ç½²åˆ°K8s | ~5åˆ†é’Ÿ |
| undeploy-k8s.sh | æ¸…ç†èµ„æº | ~1åˆ†é’Ÿ |
| deploy-all.sh | ä¸€é”®å®Œæ•´éƒ¨ç½² | ~20åˆ†é’Ÿ |

**ç‰¹ç‚¹**:
- å½©è‰²è¾“å‡ºï¼Œè¿›åº¦æ¸…æ™°
- é”™è¯¯å¤„ç†å’ŒéªŒè¯
- è‡ªåŠ¨ç­‰å¾…æœåŠ¡å°±ç»ª
- æ˜¾ç¤ºè®¿é—®åœ°å€

---

## ğŸ“ äº¤ä»˜ç‰©æ¸…å•

### 1. Dockerç›¸å…³

```
docker/
â”œâ”€â”€ eureka-server/Dockerfile
â”œâ”€â”€ gateway-service/Dockerfile
â”œâ”€â”€ account-service/Dockerfile
â”œâ”€â”€ risk-service/Dockerfile
â”œâ”€â”€ ledger-service/Dockerfile
â”œâ”€â”€ notification-service/Dockerfile
â”œâ”€â”€ transfer-service/Dockerfile
â””â”€â”€ frontend/
    â”œâ”€â”€ Dockerfile
    â””â”€â”€ nginx.conf
```

### 2. Kubernetesé…ç½®

```
k8s/
â”œâ”€â”€ namespace/namespace.yaml
â”œâ”€â”€ mysql/
â”‚   â”œâ”€â”€ mysql-deployment.yaml
â”‚   â””â”€â”€ init-databases.sql
â”œâ”€â”€ eureka-server/deployment.yaml
â”œâ”€â”€ gateway-service/deployment.yaml
â”œâ”€â”€ account-service/deployment.yaml
â”œâ”€â”€ risk-service/deployment.yaml
â”œâ”€â”€ ledger-service/deployment.yaml
â”œâ”€â”€ notification-service/deployment.yaml
â”œâ”€â”€ transfer-service/deployment.yaml
â””â”€â”€ frontend/deployment.yaml
```

### 3. è‡ªåŠ¨åŒ–è„šæœ¬

```
scripts/
â”œâ”€â”€ build-images.sh
â”œâ”€â”€ push-images.sh
â”œâ”€â”€ deploy-k8s.sh
â”œâ”€â”€ undeploy-k8s.sh
â”œâ”€â”€ deploy-all.sh
â””â”€â”€ generate-k8s-manifests.sh
```

### 4. é…ç½®æ–‡ä»¶

```
*/src/main/resources/
â”œâ”€â”€ application.yml (ä¿ç•™ - æœ¬åœ°å¼€å‘)
â””â”€â”€ application-k8s.yml (æ–°å¢ - K8sç¯å¢ƒ)
```

### 5. æ–‡æ¡£

```
â”œâ”€â”€ K8S_DEPLOYMENT_GUIDE.md      # å®Œæ•´éƒ¨ç½²æŒ‡å— (150è¡Œ)
â”œâ”€â”€ QUICK_DEPLOY.md              # å¿«é€Ÿéƒ¨ç½²å‚è€ƒ (120è¡Œ)
â”œâ”€â”€ K8S_README.md                # å®¹å™¨åŒ–æ”¹é€ è¯´æ˜ (200è¡Œ)
â”œâ”€â”€ CONTAINERIZATION_SUMMARY.md  # å®Œæˆæ€»ç»“ (180è¡Œ)
â”œâ”€â”€ DEPLOYMENT_CHECKLIST.md      # éƒ¨ç½²æ£€æŸ¥æ¸…å• (150è¡Œ)
â””â”€â”€ FINAL_REPORT.md              # æœ¬æ–‡ä»¶ - æœ€ç»ˆæŠ¥å‘Š
```

---

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### å¿«é€Ÿå¼€å§‹

```bash
# 1. ç™»å½•é•œåƒä»“åº“
docker login 1.94.151.57:85

# 2. ä¸€é”®éƒ¨ç½²
./scripts/deploy-all.sh

# 3. è·å–è®¿é—®åœ°å€
NODE_IP=$(kubectl get nodes -o jsonpath='{.items[0].status.addresses[?(@.type=="InternalIP")].address}')
echo "å‰ç«¯: http://${NODE_IP}:30000"
echo "ç½‘å…³: http://${NODE_IP}:30080"
```

### éªŒè¯éƒ¨ç½²

```bash
# æŸ¥çœ‹æ‰€æœ‰Pod
kubectl get pods -n isbank

# æŸ¥çœ‹æœåŠ¡
kubectl get svc -n isbank

# æŸ¥çœ‹æ—¥å¿—
kubectl logs -f deployment/account-service -n isbank
```

---

## âœ¨ æŠ€æœ¯äº®ç‚¹

1. **å¾®æœåŠ¡æœ€ä½³å®è·µ** - æ•°æ®åº“éš”ç¦»ã€é…ç½®åˆ†ç¦»ã€æœåŠ¡å‘ç°
2. **å®¹å™¨åŒ–ä¼˜åŒ–** - å¤šé˜¶æ®µæ„å»ºã€JVMä¼˜åŒ–ã€èµ„æºé™åˆ¶
3. **é«˜å¯ç”¨è®¾è®¡** - å¤šå‰¯æœ¬ã€å¥åº·æ£€æŸ¥ã€æ»šåŠ¨æ›´æ–°
4. **è‡ªåŠ¨åŒ–éƒ¨ç½²** - ä¸€é”®æ„å»ºã€æ¨é€ã€éƒ¨ç½²
5. **å®Œæ•´æ–‡æ¡£** - ä»å…¥é—¨åˆ°ç²¾é€šçš„å…¨å¥—æ–‡æ¡£

---

## ğŸ“Š è´¨é‡ä¿è¯

- âœ… æ‰€æœ‰æœåŠ¡å‡å¯ç‹¬ç«‹æ„å»ºå’Œéƒ¨ç½²
- âœ… æ‰€æœ‰é…ç½®æ–‡ä»¶ç»è¿‡éªŒè¯
- âœ… æ‰€æœ‰è„šæœ¬å…·æœ‰é”™è¯¯å¤„ç†
- âœ… æ‰€æœ‰æ–‡æ¡£æ¸…æ™°å®Œæ•´
- âœ… ç¬¦åˆKubernetesæœ€ä½³å®è·µ
- âœ… ç¬¦åˆå¾®æœåŠ¡æ¶æ„åŸåˆ™

---

## ğŸ“ çŸ¥è¯†æ²‰æ·€

é€šè¿‡æœ¬æ¬¡å®¹å™¨åŒ–æ”¹é€ ï¼Œå›¢é˜ŸæŒæ¡äº†ï¼š

1. **å¾®æœåŠ¡æ¶æ„** - æ•°æ®åº“éš”ç¦»ã€æœåŠ¡å‘ç°ã€é…ç½®ç®¡ç†
2. **DockeræŠ€æœ¯** - å¤šé˜¶æ®µæ„å»ºã€é•œåƒä¼˜åŒ–ã€å®¹å™¨ç¼–æ’
3. **Kubernetes** - Deploymentã€Serviceã€ConfigMapã€Secret
4. **DevOps** - è‡ªåŠ¨åŒ–æ„å»ºã€æŒç»­éƒ¨ç½²ã€ç›‘æ§å‘Šè­¦
5. **æœ€ä½³å®è·µ** - é«˜å¯ç”¨ã€å¯æ‰©å±•ã€å¯ç»´æŠ¤

---

## ğŸ”® åç»­å»ºè®®

### çŸ­æœŸ (1-2å‘¨)
1. åœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯å®Œæ•´éƒ¨ç½²æµç¨‹
2. è¿›è¡Œå‹åŠ›æµ‹è¯•å’Œæ€§èƒ½è°ƒä¼˜
3. å®Œå–„ç›‘æ§å’Œæ—¥å¿—æ”¶é›†

### ä¸­æœŸ (1-2æœˆ)
4. é…ç½®Ingressç»Ÿä¸€å…¥å£
5. é›†æˆPrometheus + Grafanaç›‘æ§
6. å®ç°CI/CDè‡ªåŠ¨åŒ–æµæ°´çº¿

### é•¿æœŸ (3-6æœˆ)
7. å®ç°HPAæ°´å¹³è‡ªåŠ¨æ‰©ç¼©å®¹
8. å¼•å…¥Service Mesh (Istio)
9. å®ç°å¤šé›†ç¾¤éƒ¨ç½²å’Œç¾å¤‡

---

## ğŸ“ æ€»ç»“

ISBankå¾®æœåŠ¡ç³»ç»Ÿå·²æˆåŠŸå®ŒæˆKuberneteså®¹å™¨åŒ–æ”¹é€ ï¼Œå…·å¤‡ä»¥ä¸‹ç‰¹ç‚¹ï¼š

âœ… **å®Œæ•´æ€§** - æ‰€æœ‰8ä¸ªæœåŠ¡å‡å·²å®¹å™¨åŒ–  
âœ… **è§„èŒƒæ€§** - éµå¾ªå¾®æœåŠ¡å’ŒK8sæœ€ä½³å®è·µ  
âœ… **è‡ªåŠ¨åŒ–** - ä¸€é”®æ„å»ºã€æ¨é€ã€éƒ¨ç½²  
âœ… **é«˜å¯ç”¨** - å¤šå‰¯æœ¬ã€å¥åº·æ£€æŸ¥ã€æ»šåŠ¨æ›´æ–°  
âœ… **å¯ç»´æŠ¤** - å®Œæ•´æ–‡æ¡£ã€æ¸…æ™°ç»“æ„  

**ç°åœ¨å¯ä»¥é€šè¿‡ä¸€æ¡å‘½ä»¤å°†æ•´ä¸ªç³»ç»Ÿéƒ¨ç½²åˆ°Kubernetesé›†ç¾¤ï¼** ğŸ‰

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2025-11-20  
**ç‰ˆæœ¬**: 1.0  
**ç»´æŠ¤è€…**: ISBank Team  
**è”ç³»æ–¹å¼**: [é¡¹ç›®ä»“åº“]

