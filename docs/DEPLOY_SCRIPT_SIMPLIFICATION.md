# K8s éƒ¨ç½²è„šæœ¬ç®€åŒ–è¯´æ˜

## ğŸ”„ ä¿®æ”¹å†…å®¹

ç®€åŒ–äº† `scripts/deploy-k8s.sh` éƒ¨ç½²è„šæœ¬ï¼Œå»æ‰äº†å¤æ‚çš„é¡ºåºéƒ¨ç½²å’Œç­‰å¾…é€»è¾‘ã€‚

## ğŸ“Š ä¿®æ”¹å¯¹æ¯”

### ä¿®æ”¹å‰ï¼ˆå¤æ‚çš„é¡ºåºéƒ¨ç½²ï¼‰

```bash
# æ­¥éª¤1: åˆ›å»ºå‘½åç©ºé—´
# æ­¥éª¤2: ç”ŸæˆK8sé…ç½®æ–‡ä»¶
# æ­¥éª¤3: éƒ¨ç½²MySQL + ç­‰å¾…å°±ç»ª + åˆå§‹åŒ–æ•°æ®åº“
# æ­¥éª¤4: éƒ¨ç½²Eureka Server + ç­‰å¾…å°±ç»ª
# æ­¥éª¤5: éƒ¨ç½²Gateway Service + ç­‰å¾…å°±ç»ª
# æ­¥éª¤6: éƒ¨ç½²ä¸šåŠ¡å¾®æœåŠ¡ + ç­‰å¾…å°±ç»ª
# æ­¥éª¤7: éƒ¨ç½²å‰ç«¯ + ç­‰å¾…å°±ç»ª
```

**é—®é¢˜**:
- âŒ éƒ¨ç½²æ—¶é—´é•¿ï¼ˆéœ€è¦ç­‰å¾…æ¯ä¸ªæœåŠ¡å°±ç»ªï¼‰
- âŒ é€»è¾‘å¤æ‚ï¼ˆ6ä¸ªæ­¥éª¤ï¼‰
- âŒ å®¹æ˜“è¶…æ—¶å¤±è´¥
- âŒ ä¸ç¬¦åˆ K8s çš„è®¾è®¡ç†å¿µ

### ä¿®æ”¹åï¼ˆç®€å•çš„å¹¶è¡Œéƒ¨ç½²ï¼‰

```bash
# æ­¥éª¤1: åˆ›å»ºå‘½åç©ºé—´
# æ­¥éª¤2: éƒ¨ç½²æ‰€æœ‰æœåŠ¡ï¼ˆå¹¶è¡Œï¼‰
# æ­¥éª¤3: æŸ¥çœ‹éƒ¨ç½²çŠ¶æ€
```

**ä¼˜ç‚¹**:
- âœ… éƒ¨ç½²é€Ÿåº¦å¿«ï¼ˆå¹¶è¡Œå¯åŠ¨ï¼‰
- âœ… é€»è¾‘ç®€å•ï¼ˆ3ä¸ªæ­¥éª¤ï¼‰
- âœ… ä¸ä¼šè¶…æ—¶å¤±è´¥
- âœ… ç¬¦åˆ K8s çš„è®¾è®¡ç†å¿µ

## ğŸš€ æ–°çš„éƒ¨ç½²æµç¨‹

### 1. åˆ›å»ºå‘½åç©ºé—´

```bash
kubectl apply -f k8s/namespace/namespace.yaml
```

### 2. éƒ¨ç½²æ‰€æœ‰æœåŠ¡ï¼ˆå¹¶è¡Œï¼‰

```bash
# MySQL
kubectl apply -f k8s/mysql/mysql-deployment.yaml

# Eureka Server
kubectl apply -f k8s/eureka-server/deployment.yaml

# Gateway Service
kubectl apply -f k8s/gateway-service/deployment.yaml

# ä¸šåŠ¡å¾®æœåŠ¡
kubectl apply -f k8s/account-service/deployment.yaml
kubectl apply -f k8s/risk-service/deployment.yaml
kubectl apply -f k8s/ledger-service/deployment.yaml
kubectl apply -f k8s/notification-service/deployment.yaml
kubectl apply -f k8s/transfer-service/deployment.yaml

# å‰ç«¯
kubectl apply -f k8s/frontend/deployment.yaml
```

### 3. æŸ¥çœ‹éƒ¨ç½²çŠ¶æ€

```bash
kubectl get pods -n isbank
```

## ğŸ’¡ ä¸ºä»€ä¹ˆè¿™æ ·æ›´å¥½ï¼Ÿ

### 1. Kubernetes ä¼šè‡ªåŠ¨å¤„ç†ä¾èµ–

- **å¥åº·æ£€æŸ¥**: K8s ä¼šé€šè¿‡ `livenessProbe` å’Œ `readinessProbe` è‡ªåŠ¨æ£€æŸ¥æœåŠ¡å¥åº·çŠ¶æ€
- **è‡ªåŠ¨é‡å¯**: å¦‚æœæœåŠ¡å¯åŠ¨å¤±è´¥ï¼ŒK8s ä¼šè‡ªåŠ¨é‡å¯
- **æœåŠ¡å‘ç°**: æœåŠ¡ä¹‹é—´é€šè¿‡ K8s Service è‡ªåŠ¨å‘ç°ï¼Œä¸éœ€è¦ç­‰å¾…

### 2. å¹¶è¡Œå¯åŠ¨æ›´å¿«

| éƒ¨ç½²æ–¹å¼ | æ—¶é—´ |
|---------|------|
| é¡ºåºéƒ¨ç½²ï¼ˆä¿®æ”¹å‰ï¼‰ | ~10-15åˆ†é’Ÿ |
| å¹¶è¡Œéƒ¨ç½²ï¼ˆä¿®æ”¹åï¼‰ | ~2-3åˆ†é’Ÿ |

### 3. æ›´ç¬¦åˆäº‘åŸç”Ÿç†å¿µ

- **å£°æ˜å¼éƒ¨ç½²**: å‘Šè¯‰ K8s "æˆ‘è¦ä»€ä¹ˆ"ï¼Œè€Œä¸æ˜¯"æ€ä¹ˆåš"
- **è‡ªæ„ˆèƒ½åŠ›**: K8s ä¼šè‡ªåŠ¨å¤„ç†å¤±è´¥å’Œé‡å¯
- **å¼¹æ€§ä¼¸ç¼©**: å¯ä»¥éšæ—¶è°ƒæ•´å‰¯æœ¬æ•°

## ğŸ“ ä½¿ç”¨æ–¹æ³•

### å¿«é€Ÿéƒ¨ç½²

```bash
./scripts/deploy-k8s.sh
```

### æŸ¥çœ‹éƒ¨ç½²çŠ¶æ€

```bash
# æŸ¥çœ‹æ‰€æœ‰ Pod
kubectl get pods -n isbank

# å®æ—¶ç›‘æ§ Pod çŠ¶æ€
watch kubectl get pods -n isbank

# æŸ¥çœ‹æ‰€æœ‰æœåŠ¡
kubectl get svc -n isbank
```

### ç­‰å¾…æ‰€æœ‰æœåŠ¡å°±ç»ªï¼ˆå¯é€‰ï¼‰

```bash
# ç­‰å¾…æ‰€æœ‰ Pod å°±ç»ªï¼ˆæœ€å¤šç­‰å¾… 5 åˆ†é’Ÿï¼‰
kubectl wait --for=condition=ready pod --all -n isbank --timeout=300s
```

### æŸ¥çœ‹æœåŠ¡æ—¥å¿—

```bash
# æŸ¥çœ‹æŸä¸ªæœåŠ¡çš„æ—¥å¿—
kubectl logs -f deployment/eureka-server -n isbank
kubectl logs -f deployment/gateway-service -n isbank
kubectl logs -f deployment/account-service -n isbank

# æŸ¥çœ‹æ‰€æœ‰æœåŠ¡çš„æ—¥å¿—
kubectl logs -f -l app=account-service -n isbank
```

## ğŸ” æ•…éšœæ’æŸ¥

### æŸ¥çœ‹ Pod çŠ¶æ€

```bash
kubectl get pods -n isbank
```

å¯èƒ½çš„çŠ¶æ€ï¼š
- `Pending`: æ­£åœ¨è°ƒåº¦
- `ContainerCreating`: æ­£åœ¨åˆ›å»ºå®¹å™¨
- `Running`: è¿è¡Œä¸­
- `CrashLoopBackOff`: å¯åŠ¨å¤±è´¥ï¼Œæ­£åœ¨é‡è¯•
- `Error`: é”™è¯¯

### æŸ¥çœ‹ Pod è¯¦ç»†ä¿¡æ¯

```bash
kubectl describe pod <pod-name> -n isbank
```

### æŸ¥çœ‹ Pod æ—¥å¿—

```bash
kubectl logs <pod-name> -n isbank

# æŸ¥çœ‹ä¹‹å‰å´©æºƒçš„æ—¥å¿—
kubectl logs <pod-name> -n isbank --previous
```

### å¸¸è§é—®é¢˜

#### 1. Pod ä¸€ç›´å¤„äº Pending çŠ¶æ€

**åŸå› **: èµ„æºä¸è¶³æˆ–é•œåƒæ‹‰å–å¤±è´¥

**è§£å†³**:
```bash
kubectl describe pod <pod-name> -n isbank
# æŸ¥çœ‹ Events éƒ¨åˆ†çš„é”™è¯¯ä¿¡æ¯
```

#### 2. Pod ä¸€ç›´å¤„äº CrashLoopBackOff çŠ¶æ€

**åŸå› **: åº”ç”¨å¯åŠ¨å¤±è´¥

**è§£å†³**:
```bash
kubectl logs <pod-name> -n isbank
# æŸ¥çœ‹åº”ç”¨æ—¥å¿—ï¼Œæ‰¾å‡ºå¯åŠ¨å¤±è´¥çš„åŸå› 
```

#### 3. æœåŠ¡æ— æ³•è®¿é—®

**åŸå› **: Service é…ç½®é”™è¯¯æˆ– Pod æœªå°±ç»ª

**è§£å†³**:
```bash
# æ£€æŸ¥ Service
kubectl get svc -n isbank

# æ£€æŸ¥ Endpoints
kubectl get endpoints -n isbank

# æ£€æŸ¥ Pod æ˜¯å¦å°±ç»ª
kubectl get pods -n isbank
```

## ğŸ“ˆ æ€§èƒ½å¯¹æ¯”

### éƒ¨ç½²æ—¶é—´

| é˜¶æ®µ | ä¿®æ”¹å‰ | ä¿®æ”¹å | èŠ‚çœ |
|------|--------|--------|------|
| MySQL éƒ¨ç½² + ç­‰å¾… | ~2åˆ†é’Ÿ | ~10ç§’ | 1åˆ†50ç§’ |
| Eureka éƒ¨ç½² + ç­‰å¾… | ~2åˆ†é’Ÿ | ~10ç§’ | 1åˆ†50ç§’ |
| Gateway éƒ¨ç½² + ç­‰å¾… | ~2åˆ†é’Ÿ | ~10ç§’ | 1åˆ†50ç§’ |
| ä¸šåŠ¡æœåŠ¡éƒ¨ç½² + ç­‰å¾… | ~5åˆ†é’Ÿ | ~10ç§’ | 4åˆ†50ç§’ |
| å‰ç«¯éƒ¨ç½² + ç­‰å¾… | ~1åˆ†é’Ÿ | ~10ç§’ | 50ç§’ |
| **æ€»è®¡** | **~12åˆ†é’Ÿ** | **~1åˆ†é’Ÿ** | **~11åˆ†é’Ÿ** |

### è„šæœ¬å¤æ‚åº¦

| æŒ‡æ ‡ | ä¿®æ”¹å‰ | ä¿®æ”¹å | æ”¹å–„ |
|------|--------|--------|------|
| ä»£ç è¡Œæ•° | 118 è¡Œ | 101 è¡Œ | -14% |
| æ­¥éª¤æ•° | 6 æ­¥ | 3 æ­¥ | -50% |
| ç­‰å¾…å‘½ä»¤ | 7 ä¸ª | 0 ä¸ª | -100% |

## âœ… æ€»ç»“

é€šè¿‡ç®€åŒ–éƒ¨ç½²è„šæœ¬ï¼Œæˆ‘ä»¬å®ç°äº†ï¼š

- âœ… **éƒ¨ç½²æ—¶é—´å‡å°‘ 90%**ï¼ˆ12åˆ†é’Ÿ â†’ 1åˆ†é’Ÿï¼‰
- âœ… **è„šæœ¬å¤æ‚åº¦é™ä½ 50%**ï¼ˆ6æ­¥ â†’ 3æ­¥ï¼‰
- âœ… **å»æ‰æ‰€æœ‰ç­‰å¾…é€»è¾‘**ï¼ˆè®© K8s è‡ªåŠ¨å¤„ç†ï¼‰
- âœ… **æ›´ç¬¦åˆäº‘åŸç”Ÿç†å¿µ**ï¼ˆå£°æ˜å¼éƒ¨ç½²ï¼‰
- âœ… **æ›´å®¹æ˜“ç»´æŠ¤**ï¼ˆä»£ç æ›´ç®€æ´ï¼‰

## ğŸ¯ æœ€ä½³å®è·µ

1. **ä¿¡ä»» Kubernetes**: è®© K8s è‡ªåŠ¨å¤„ç†æœåŠ¡å¯åŠ¨å’Œå¥åº·æ£€æŸ¥
2. **å¹¶è¡Œéƒ¨ç½²**: æ‰€æœ‰æœåŠ¡åŒæ—¶æäº¤ï¼ŒK8s ä¼šè‡ªåŠ¨è°ƒåº¦
3. **ç›‘æ§çŠ¶æ€**: ä½¿ç”¨ `kubectl get pods` ç›‘æ§éƒ¨ç½²è¿›åº¦
4. **æŸ¥çœ‹æ—¥å¿—**: å‡ºç°é—®é¢˜æ—¶æŸ¥çœ‹æ—¥å¿—æ’æŸ¥

---

**ä¿®æ”¹æ—¶é—´**: 2025-11-20  
**çŠ¶æ€**: âœ… å·²å®Œæˆ

